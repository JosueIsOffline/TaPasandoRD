{% extends "layout.html.twig" %}

{% block styles %}
{{parent()}}
<style>
  .map{
    height: 400px;  
    display: flex; 
    align-items: center; 
    justify-content: center;
  }
</style>
{% endblock %}

{% block content %}
            <div class="container-fluid p-4">
                <div class="row mb-4">
                    <div class="col-12">
                        <h1 class="mb-0">Reportar Incidencia</h1>
                        <p class="text-muted">Registra una nueva incidencia en el sistema</p>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-8">
                        <div class="card incident-card">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">Información de la Incidencia</h5>
                            </div>
                            <div class="card-body">
                                <form>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Fecha de Ocurrencia</label>
                                                <input type="datetime-local" class="form-control">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Título</label>
                                                <input type="text" class="form-control" placeholder="Título descriptivo">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Tipo de Incidencia</label>
                                        <div class="row">
                                            <div class="col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="accidente">
                                                    <label class="form-check-label" for="accidente">Accidente</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="pelea">
                                                    <label class="form-check-label" for="pelea">Pelea</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="robo">
                                                    <label class="form-check-label" for="robo">Robo</label>
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <div class="form-check">
                                                    <input class="form-check-input" type="checkbox" id="desastre">
                                                    <label class="form-check-label" for="desastre">Desastre</label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Descripción</label>
                                        <textarea class="form-control" rows="4" placeholder="Describe los detalles de la incidencia..."></textarea>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Provincia</label>
                                                <select class="form-select">
                                                    <option>Seleccionar provincia</option>
                                                    <option>Distrito Nacional</option>
                                                    <option>Santo Domingo</option>
                                                    <option>Santiago</option>
                                                    <option>La Vega</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Municipio</label>
                                                <select class="form-select">
                                                    <option>Seleccionar municipio</option>
                                                    <option>Santo Domingo Este</option>
                                                    <option>Santo Domingo Norte</option>
                                                    <option>Santo Domingo Oeste</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Barrio</label>
                                                <input type="text" class="form-control" placeholder="Nombre del barrio">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Latitud</label>
                                                <input type="number" id="latitude" class="form-control" placeholder="18.4861" step="any">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">Longitud</label>
                                                <input type="number" id="longitude" class="form-control" placeholder="-69.9312" step="any">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Muertos</label>
                                                <input type="number" class="form-control" placeholder="0" min="0">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Heridos</label>
                                                <input type="number" class="form-control" placeholder="0" min="0">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label class="form-label">Pérdida Estimada</label>
                                                <input type="number" class="form-control" placeholder="0" min="0">
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Link a Redes Sociales</label>
                                        <input type="url" class="form-control" placeholder="https://...">
                                    </div>

                                    <div class="mb-3">
                                        <label class="form-label">Foto del Hecho</label>
                                        <input type="file" class="form-control" accept="image/*">
                                    </div>

                                    <div class="d-grid gap-2">
                                        <button type="submit" class="btn btn-primary btn-lg">
                                            <i class="fas fa-paper-plane me-2"></i>
                                            Enviar Reporte
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card incident-card mt-4">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">Seleccionar Ubicación</h5>
                            </div>
                            <div class="card-body p-0">
                                <div class="map" id="map">
                                    <!-- <div class="text-center"> -->
                                    <!--     <i class="fas fa-map-marker-alt fa-3x text-primary mb-3"></i> -->
                                    <!--     <p class="text-muted">Haz clic en el mapa para seleccionar la ubicación exacta</p> -->
                                    <!-- </div> -->
                                </div>
                            </div>
                        </div>

                        <div class="card incident-card mt-3">
                            <div class="card-header bg-white">
                                <h5 class="mb-0">Información</h5>
                            </div>
                            <div class="card-body">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Tu reporte será revisado por un validador antes de ser publicado.
                                </div>
                                <div class="alert alert-warning">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Asegúrate de que toda la información sea veraz y precisa.
                                </div>
                                <div class="alert alert-success">
                                    <i class="fas fa-map-marker-alt me-2"></i>
                                    Haz clic en el mapa para seleccionar la ubicación exacta o ingresa las coordenadas manualmente.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
{% endblock %}

{% block scripts %}
  <script>
    var map;
    var marker;
    var latInput = document.getElementById('latitude');
    var lngInput = document.getElementById('longitude');
    
    map = L.map('map').setView([18.7357, -70.1627], 8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '© OpenStreetMap contributors'
    }).addTo(map);
    
    function updateMarker(lat, lng) {
        if (marker) {
            map.removeLayer(marker);
        }
        
        marker = L.marker([lat, lng], {
            icon: L.icon({
                iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
                shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
                iconSize: [25, 41],
                iconAnchor: [12, 41],
                popupAnchor: [1, -34],
                shadowSize: [41, 41]
            })
        }).addTo(map);
        
        marker.bindPopup(`
            <b>Ubicación Seleccionada</b><br>
            Latitud: ${lat.toFixed(6)}<br>
            Longitud: ${lng.toFixed(6)}
        `).openPopup();
    }
    
    map.on('click', function(e) {
        var lat = e.latlng.lat;
        var lng = e.latlng.lng;
        
        latInput.value = lat.toFixed(6);
        lngInput.value = lng.toFixed(6);
        
        updateMarker(lat, lng);
    });
    
    function updateMapFromInputs() {
        var lat = parseFloat(latInput.value);
        var lng = parseFloat(lngInput.value);
        
        if (!isNaN(lat) && !isNaN(lng) && 
            lat >= -90 && lat <= 90 && 
            lng >= -180 && lng <= 180) {
            
            map.setView([lat, lng], 13);
            
            updateMarker(lat, lng);
        }
    }
    
    latInput.addEventListener('blur', updateMapFromInputs);
    lngInput.addEventListener('blur', updateMapFromInputs);
    
    latInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            updateMapFromInputs();
        }
    });
    
    lngInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            updateMapFromInputs();
        }
    });
    
    // Función opcional para limpiar la selección
    function clearLocation() {
        if (marker) {
            map.removeLayer(marker);
            marker = null;
        }
        latInput.value = '';
        lngInput.value = '';
    }
      
  </script>
{% endblock %}
